<!doctype html>
<html>
  <head>
    <title>Duplicate Offender Details</title>
    <style>
      body {
        font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        font-size: 1em;
        padding: 20px;
      }

      table {
        border-collapse: collapse;
        width: 100%;
      }

      th,
      td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
      }

      th {
        background-color: #17d1a3ff;
        position: sticky;
        top: 0;
      }

      tr:nth-child(even) {
        background-color: #f2f2f2;
      }

      .patient-name {
        width: 20%;
      }

      .number-cell {
        text-align: right;
      }

      .loading-message {
        padding: 20px;
        text-align: center;
        font-size: 1.2em;
        color: #666;
      }

      .error-message {
        padding: 20px;
        text-align: center;
        color: red;
      }
    </style>
    <script>
      window.onload = function () {
        const tableBody = document.getElementById("tableBody");

        // Show loading message initially
        tableBody.innerHTML =
          '<tr><td colspan="7" class="loading-message">Loading patient details...</td></tr>';

        try {
          const data = JSON.parse(
            sessionStorage.getItem("offenderDetailsData"),
          );

          if (!data || data.length === 0) {
            tableBody.innerHTML =
              '<tr><td colspan="7" class="error-message">No details found</td></tr>';
            return;
          }

          // Clear loading message and display data
          tableBody.innerHTML = "";

          let rowCount = 0;
          data.forEach((row) => {
            const issueDate = row.IssueDate
              ? new Date(row.IssueDate).toLocaleDateString()
              : "N/A";

            tableBody.innerHTML += `
              <tr>
                <td>${row.PatShortSSN || "N/A"}</td>
                <td class="patient-name">${row.PatientName || "N/A"}</td>
                <td>${row.ItemIEN || "N/A"}</td>
                <td>${row.StationID || "N/A"}</td>
                <td>${issueDate}</td>
                <td class="number-cell">${row.TimesIssued || 0}</td>
                <td>${row.AllStations || "N/A"}</td>
              </tr>
            `;
            rowCount++;
          });

          // Update title to show row count
          document.title = `Offender Details (${rowCount} records)`;
        } catch (error) {
          console.error("Error displaying data:", error);
          tableBody.innerHTML =
            '<tr><td colspan="7" class="error-message">Error loading data. Please try again.</td></tr>';
        }
      };
    </script>
  </head>
  <body>
    <h2>Duplicate Issue Details</h2>
    <table>
      <thead>
        <tr>
          <th>Patient SSN</th>
          <th class="patient-name">Patient Name</th>
          <th>Item IEN</th>
          <th>Station ID</th>
          <th>Issue Date</th>
          <th>Times Issued (all time)</th>
          <th>All Stations (all time)</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- Loading message shows here initially -->
      </tbody>
    </table>
  </body>
</html>
